#!/bin/bash
echo "Before assembling"

/usr/libexec/s2i/assemble
rc=$?

if [ $rc -eq 0 ]; then
    echo "After successful assembling"
else
    echo "After failed assembling"
	echo "---> Building in production mode"
	npm run build --if-present
	echo "---> Fix permissions on app-root"
	fix-permissions /opt/app-root
fi

exit $rc